<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Center Car — Εκτελωνισμοί (Demo)</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0e1526; --line:#1d2742;
      --ink:#e6edf6; --muted:#9db1cf; --blue:#2b77ff; --ok:#1fbf75; --danger:#e25555;
      --chip:#15203a; --chipOn:#1e3a8a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
    header{position:sticky;top:0;z-index:5;background:var(--panel);border-bottom:1px solid var(--line)}
    h1{margin:0;font-size:18px}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .c12{grid-column:span 12} .c6{grid-column:span 6} .c4{grid-column:span 4} .c3{grid-column:span 3}
    @media (max-width:760px){ .row{grid-template-columns:repeat(6,1fr)} .c6{grid-column:span 6} .c4{grid-column:span 6} .c3{grid-column:span 3} }
    .card{background:var(--panel);border:1px solid var(--line);border-radius:10px;padding:14px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;height:42px;padding:0 10px;border-radius:8px;border:1px solid var(--line);background:#0d162b;color:var(--ink)}
    input::placeholder{color:#7f93b2}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--chip);border:1px solid var(--line);border-radius:999px;padding:7px 10px;font-size:13px;cursor:pointer;user-select:none}
    .chip.on{background:var(--chipOn)}
    .btn{border:1px solid var(--line);background:#13213e;color:var(--ink);padding:10px 12px;border-radius:8px;cursor:pointer}
    .primary{background:var(--blue);border-color:#1b5de6}
    .ok{background:var(--ok);border-color:#0c9f5f}
    .danger{background:var(--danger);border-color:#c13b3b}
    .ghost{background:#0d162b}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:12px}
    .item{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
    .badge{display:inline-block;background:#203056;border:1px solid var(--line);padding:2px 8px;border-radius:999px;margin-right:6px;font-size:12px}
    .right{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    /* CFG panel */
    .cfgBtn{position:absolute;right:14px;top:14px;background:#1a2750;border:1px solid var(--line);padding:6px 10px;border-radius:8px;cursor:pointer}
    #cfgPanel{display:none;margin-top:12px}
    #cfgPanel.show{display:block}
    #cfgPanel .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width:760px){ #cfgPanel .grid{grid-template-columns:repeat(2,1fr)} }
    #cfgPanel input{height:36px}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="position:relative">
      <h1>Center Car — Εκτελωνισμοί</h1>
      <button id="cfgBtn" class="cfgBtn">CFG</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Φόρμα -->
    <div class="card" style="margin-top:12px">
      <div class="row">
        <div class="c3">
          <label>Euro</label>
          <select id="euro">
            <option>Euro 6</option>
            <option>Euro 5</option>
            <option>Euro 4</option>
          </select>
        </div>
        <div class="c3">
          <label>CO₂ (g/km)</label>
          <input id="co2" type="number" placeholder="π.χ. 129">
        </div>
        <div class="c3">
          <label>Κυβικά (cc)</label>
          <input id="cc" type="number" placeholder="π.χ. 1499">
        </div>
        <div class="c3">
          <label>VIN</label>
          <input id="vin" placeholder="π.χ. WBA...">
        </div>

        <div class="c3">
          <label>Κατηγορία</label>
          <div class="chips" id="catChips">
            <div class="chip on" data-val="M1">M1</div>
            <div class="chip" data-val="N1">N1</div>
          </div>
        </div>

        <div class="c3">
          <label>Καύσιμο</label>
          <div class="chips" id="fuelChips">
            <div class="chip on" data-val="petrol">Βενζίνη</div>
            <div class="chip" data-val="diesel">Πετρέλαιο</div>
          </div>
        </div>

        <div class="c3">
          <label>Υβριδισμός</label>
          <div class="chips" id="hybridChips">
            <div class="chip on" data-val="none">Κανένα</div>
            <div class="chip" data-val="mhev">Mild Hybrid</div>
            <div class="chip" data-val="phev">Plug-in Hybrid</div>
          </div>
        </div>

        <div class="c3">
          <label>Κιβώτιο</label>
          <div class="chips" id="gearChips">
            <div class="chip on" data-val="manual">Χειροκίνητο</div>
            <div class="chip" data-val="auto">Αυτόματο</div>
          </div>
        </div>

        <div class="c3">
          <label>Ημ/νία παραγωγής</label>
          <input id="prodDate" type="date">
        </div>

        <div class="c3">
          <label>Χιλιόμετρα</label>
          <input id="km" type="number" placeholder="π.χ. 70000">
        </div>

        <div class="c3">
          <label>Τιμή αγοράς (€)</label>
          <input id="purchase" type="number" step="0.01" placeholder="π.χ. 49990">
        </div>

        <div class="c3">
          <label>Λιανική προ-φόρων (€) (προαιρετικό)</label>
          <input id="pretax" type="number" step="0.01" placeholder="αν τη γνωρίζεις">
        </div>

        <div class="c12">
          <label>Εξοπλισμός</label>
          <div class="chips" id="extras">
            <div class="chip" data-val="navi">Navi</div>
            <div class="chip" data-val="rims">Ζάντες</div>
            <div class="chip" data-val="park">Parktronic</div>
            <div class="chip" data-val="hud">Head-Up</div>
            <div class="chip" data-val="cam">Κάμερα</div>
            <div class="chip" data-val="roof">Οροφή</div>
            <div class="chip" data-val="leather">Δερμάτινα</div>
          </div>
        </div>

        <div class="c3">
          <label>§25α (ΦΠΑ)</label>
          <div class="chips" id="paraChips">
            <div class="chip on" data-val="yes">Ναι (χωρίς ΦΠΑ)</div>
            <div class="chip" data-val="no">Όχι</div>
          </div>
        </div>

        <div class="c3">
          <label>Εκτίμηση Τελωνείου (€)</label>
          <input id="estCustoms" type="number" readonly placeholder="πάτησε Υπολόγισε">
        </div>

        <div class="c3">
          <label>Κλειδωμένο Τελωνείο (τελικό)</label>
          <input id="lockedCustoms" type="number" placeholder="π.χ. 8500">
        </div>

        <div class="c12 toolbar">
          <button class="btn" id="calcBtn">Υπολόγισε</button>
          <button class="btn ok" id="savePerm">Αποθήκευση (Μόνιμα)</button>
          <button class="btn ghost" id="clearBtn">Καθαρισμός</button>
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Demo υπολογισμός: ρυθμίζεται από το CFG.</div>
    </div>

    <!-- Λίστα -->
    <div id="list" class="list" style="margin-top:12px"></div>

    <!-- CFG PANEL -->
    <div id="cfgPanel" class="card">
      <h3 style="margin-top:0">Ρυθμίσεις CFG</h3>
      <div class="grid">
        <div><label>Βάση % Euro 6</label><input id="cfg_e6" type="number" step="0.001"></div>
        <div><label>Βάση % Euro 5</label><input id="cfg_e5" type="number" step="0.001"></div>
        <div><label>Βάση % Euro 4</label><input id="cfg_e4" type="number" step="0.001"></div>

        <div><label>CO₂ Floor</label><input id="cfg_floor" type="number"></div>
        <div><label>€ / g πάνω από Floor</label><input id="cfg_rate" type="number" step="0.01"></div>

        <div><label>MHEV x</label><input id="cfg_mhev" type="number" step="0.01"></div>
        <div><label>PHEV x</label><input id="cfg_phev" type="number" step="0.01"></div>

        <div><label>Petrol x</label><input id="cfg_petrol" type="number" step="0.01"></div>
        <div><label>Diesel x</label><input id="cfg_diesel" type="number" step="0.01"></div>

        <div><label>M1 x</label><input id="cfg_m1" type="number" step="0.01"></div>
        <div><label>N1 x</label><input id="cfg_n1" type="number" step="0.01"></div>

        <div><label>Uplift x</label><input id="cfg_uplift" type="number" step="0.01"></div>
        <div><label>€/έτος παλαιότητας</label><input id="cfg_age" type="number" step="0.01"></div>
        <div><label>Περιβαλλοντικό Euro 5 (€)</label><input id="cfg_env5" type="number"></div>
      </div>

      <div class="toolbar" style="margin-top:12px">
        <button class="btn ok" id="cfgSave">Αποθήκευση CFG</button>
        <button class="btn" id="cfgReset">Επαναφορά</button>
        <button class="btn" id="openCfg">Κλείσιμο</button>
        <span class="muted" style="margin-left:auto">Import/Export:</span>
        <button class="btn" id="cfgExport">Export CFG</button>
        <input type="file" id="cfgImport" style="display:none" accept=".json,application/json">
        <button class="btn" id="cfgImportBtn">Import CFG</button>
      </div>
    </div>
  </main>

  <script>
    // ======== CFG (ρυθμιζόμενα) ========
    const CFG_KEY = 'cc_cfg_v3';
    const CFG_DEFAULT = {
      basePct: {'Euro 6':0.160,'Euro 5':0.180,'Euro 4':0.220},
      co2Floor:120, co2Rate:5,
      hybrid:{none:1.00,mhev:0.85,phev:0.65},
      fuel:{petrol:1.00,diesel:1.06},
      category:{M1:1.00,N1:1.00},
      agePerYear:0.00,
      uplift:1.35,
      envFeeEuro5:1000
    };
    const loadCFG = ()=>{ try{return JSON.parse(localStorage.getItem(CFG_KEY))||CFG_DEFAULT}catch{return CFG_DEFAULT}};
    const saveCFG = v => localStorage.setItem(CFG_KEY, JSON.stringify(v));
    let CFG = loadCFG();

    // ======== helpers UI ========
    const $ = s=>document.querySelector(s);
    const $$ = s=>document.querySelectorAll(s);
    const fmt = n => (n==null||isNaN(n))? '—' : n.toLocaleString('el-GR');

    function bindSingle(containerSel){
      const c = $(containerSel); if(!c) return ()=>null;
      const chips = Array.from(c.querySelectorAll('.chip'));
      chips.forEach(ch=>{
        ch.addEventListener('click',()=>{
          const was = ch.classList.contains('on');
          chips.forEach(x=>x.classList.remove('on'));
          if(!was) ch.classList.add('on');
        });
      });
      return ()=> (c.querySelector('.chip.on')?.dataset.val || null);
    }
    function bindMulti(containerSel){
      const c = $(containerSel); if(!c) return ()=>[];
      c.querySelectorAll('.chip').forEach(ch=>{
        ch.addEventListener('click',()=>ch.classList.toggle('on'));
      });
      return ()=> Array.from(c.querySelectorAll('.chip.on')).map(x=>x.dataset.val);
    }

    const getFuel   = bindSingle('#fuelChips');
    const getCat    = bindSingle('#catChips');
    const getHybrid = bindSingle('#hybridChips');
    const getGear   = bindSingle('#gearChips');
    const getExtras = bindMulti('#extras');
    const getPara   = bindSingle('#paraChips');

    // ======== υπολογισμός ========
    function estimateCustoms(x){
      const euroBase = CFG.basePct[x.euro] ?? 0.18;
      const basis = (x.pretax>0? x.pretax : x.purchase) * euroBase;

      let mult = 1;
      mult *= CFG.hybrid[x.hybrid] ?? 1;
      mult *= CFG.fuel[x.fuel] ?? 1;
      mult *= CFG.category[x.category] ?? 1;

      const floor = CFG.co2Floor ?? 120;
      const rate  = CFG.co2Rate ?? 5;
      const co2Adj = Math.max(0, (x.co2||0) - floor) * rate;

      const env5 = x.euro==='Euro 5' ? (CFG.envFeeEuro5||0) : 0;

      // παλαιότητα (προαιρετικό, default 0)
      let ageAdj = 0;
      if (CFG.agePerYear>0 && x.prodDate) {
        const years = Math.max(0, (new Date().getFullYear() - new Date(x.prodDate).getFullYear()));
        ageAdj = (CFG.agePerYear||0) * years;
      }
      const uplift = CFG.uplift || 1;

      const raw = (basis * mult * uplift) + co2Adj + env5 + ageAdj;
      return Math.max(0, Math.round(raw));
    }

    // ======== Αποθήκευση / φόρμα ========
    const KEY_PERM = 'cc_customs_perm_v3';
    const loadPerm = ()=>{ try{return JSON.parse(localStorage.getItem(KEY_PERM))||[]}catch{return[]} };
    const savePerm = arr => localStorage.setItem(KEY_PERM, JSON.stringify(arr));
    let draft = []; // πρόχειρα
    let editCtx = null;

    function readForm(){
      return {
        id: editCtx?.id || Date.now(),
        euro: $('#euro').value,
        co2:+$('#co2').value||0,
        cc:+$('#cc').value||0,
        vin:$('#vin').value.trim(),
        category:getCat()||'M1',
        fuel:getFuel()||'petrol',
        hybrid:getHybrid()||'none',
        gear:getGear()||'manual',
        prodDate: $('#prodDate').value || '',
        km:+$('#km').value||0,
        purchase:+$('#purchase').value||0,
        pretax:+$('#pretax').value||0,
        extras:getExtras(),
        para:getPara()==='yes'?'yes':'no',
        estCustoms:+$('#estCustoms').value||0,
        lockedCustoms:+$('#lockedCustoms').value||0,
        makeModel: $('#makeModel')?.value || '' // (αν αργότερα προσθέσεις πεδίο)
      };
    }
    function fillForm(x){
      $('#euro').value = x.euro;
      $('#co2').value = x.co2||'';
      $('#cc').value = x.cc||'';
      $('#vin').value = x.vin||'';
      $('#prodDate').value = x.prodDate||'';
      $('#km').value = x.km||'';
      $('#purchase').value = x.purchase||'';
      $('#pretax').value = x.pretax||'';
      $('#estCustoms').value = x.estCustoms||'';
      $('#lockedCustoms').value = x.lockedCustoms||'';
      // chips
      ['#catChips','#fuelChips','#hybridChips','#gearChips','#extras','#paraChips'].forEach(sel=>{
        $(sel).querySelectorAll('.chip').forEach(ch=>ch.classList.remove('on'));
      });
      // single
      const setSingle = (sel,val)=>{ const el=[...$(sel).querySelectorAll('.chip')].find(c=>c.dataset.val==val); if(el) el.classList.add('on') };
      setSingle('#catChips', x.category||'M1');
      setSingle('#fuelChips', x.fuel||'petrol');
      setSingle('#hybridChips', x.hybrid||'none');
      setSingle('#gearChips', x.gear||'manual');
      setSingle('#paraChips', x.para==='yes'?'yes':'no');
      // multi
      x.extras?.forEach(v=>{ const el=[...$('#extras').querySelectorAll('.chip')].find(c=>c.dataset.val==v); if(el) el.classList.add('on') });
    }

    function render(){
      const host = $('#list');
      const arr = loadPerm();
      if(!arr.length){ host.innerHTML = '<div class="muted">Δεν υπάρχουν καταχωρήσεις.</div>'; return; }
      host.innerHTML = '';
      arr.forEach(x=>{
        const locked = (x.lockedCustoms!=null && !isNaN(x.lockedCustoms) && x.lockedCustoms>0);
        const div = document.createElement('div');
        div.className='item';
        div.innerHTML = `
          <div class="row" style="align-items:flex-start">
            <div class="c12">
              <strong>${x.makeModel||'Καταχώρηση'}</strong>
            </div>
            <div class="c8">
              <span class="badge">${x.euro||''}</span>
              <span class="badge">${x.co2||0} g/km</span>
              <span class="badge">${(x.fuel==='petrol')?'Petrol':'Diesel'}</span>
              ${x.hybrid!=='none'? `<span class="badge">${x.hybrid.toUpperCase()}</span>`:''}
              ${x.category==='M1'? `<span class="badge">M1</span>`:`<span class="badge">N1</span>`}
              ${x.para==='yes'? `<span class="badge">25a</span>`:''}
              <div class="muted" style="margin-top:6px">VIN: ${x.vin||'—'}</div>
              <div class="muted">Παραγωγή: ${x.prodDate||'—'} — Χλμ: ${fmt(x.km)}</div>
              <div>Αγορά: <strong>${fmt(x.purchase)} €</strong>${x.pretax? ` — Προ-φόρων: <strong>${fmt(x.pretax)} €</strong>`:''}</div>
              <div>Τελωνείο: <strong>${fmt(locked? x.lockedCustoms : x.estCustoms)} €</strong> ${locked? '(κλειδωμένο)':'(εκτίμηση)'}</div>
              <div class="muted">${(x.extras||[]).join(', ')}</div>
            </div>
            <div class="c4 right">
              <button class="btn" data-edit="${x.id}">Επεξεργασία</button>
              <button class="btn danger" data-del="${x.id}">Διαγραφή</button>
            </div>
          </div>
        `;
        host.appendChild(div);
      });

      // bind edit / delete
      host.querySelectorAll('[data-edit]').forEach(b=>{
        b.onclick = ()=>{
          const id = +b.dataset.edit;
          const x = loadPerm().find(r=>r.id===id);
          if(!x) return;
          editCtx = {id};
          fillForm(x);
          window.scrollTo({top:0,behavior:'smooth'});
        };
      });
      host.querySelectorAll('[data-del]').forEach(b=>{
        b.onclick = ()=>{
          const id = +b.dataset.del;
          const arr = loadPerm().filter(r=>r.id!==id);
          savePerm(arr); render();
        };
      });
    }

    // ======= Export Golden Cases (CSV) – προαιρετικό κουμπί, αν θέλεις βάλε κάπου να το καλείς
    function exportLockedCSV(){
      const arr = loadPerm().filter(x=>x.lockedCustoms!=null && !isNaN(x.lockedCustoms));
      if(!arr.length){ alert('Δεν υπάρχουν κλειδωμένα.'); return; }
      const cols = ["makeModel","vin","euro","co2","cc","km","fuel","hybrid","category","purchase","pretax","para","prodDate","lockedCustoms"];
      const lines = [cols.join(',')];
      arr.forEach(row=>{
        const v = k => {
          let t = row[k];
          if(t==null) t='';
          if(typeof t==='string') t = '"' + t.replace(/"/g,'""') + '"';
          return t;
        };
        lines.push(cols.map(v).join(','));
      });
      const blob = new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'golden_cases.csv';
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ======= Σύνδεση κουμπιών φόρμας
    $('#calcBtn').onclick = ()=>{
      const x = readForm();
      $('#estCustoms').value = estimateCustoms(x);
    };
    $('#savePerm').onclick = ()=>{
      const x = readForm();
      if(!x.estCustoms && !x.lockedCustoms){ x.estCustoms = estimateCustoms(x); }
      const arr = loadPerm();
      const idx = arr.findIndex(r=>r.id===x.id);
      if(idx>=0) arr[idx]=x; else arr.push(x);
      savePerm(arr); editCtx=null; render();
      alert('Αποθηκεύτηκε.');
    };
    $('#clearBtn').onclick = ()=>{
      editCtx=null;
      document.querySelectorAll('input').forEach(i=>i.value='');
      ['#catChips','#fuelChips','#hybridChips','#gearChips','#paraChips','#extras'].forEach(sel=>{
        const c=$(sel); c.querySelectorAll('.chip').forEach(ch=>ch.classList.remove('on'));
        // default επιλογές
        if(sel!=='#extras'){ c.querySelector('.chip')?.classList.add('on'); }
      });
      $('#euro').value='Euro 6';
    };

    // ======= CFG panel toggle + import/export
    function setCfgParam(on){
      const url = new URL(location.href);
      if(on) url.searchParams.set('cfg','1'); else url.searchParams.delete('cfg');
      location.href = url.toString();
    }
    function toggleCfg(){
      const url = new URL(location.href);
      const isOn = url.searchParams.get('cfg')==='1';
      setCfgParam(!isOn);
    }
    document.getElementById('cfgBtn').onclick = toggleCfg;
    const openCfgBtn = document.getElementById('openCfg');
    if(openCfgBtn) openCfgBtn.onclick = ()=> setCfgParam(false);

    function showCfgIfNeeded(){
      const cfgOn = new URLSearchParams(location.search).get('cfg')==='1';
      if(cfgOn){
        const p = document.getElementById('cfgPanel');
        p.classList.add('show');
        document.getElementById('cfgBtn').textContent = 'Έξοδος CFG';
        // fill inputs
        document.getElementById('cfg_e6').value = CFG.basePct['Euro 6'];
        document.getElementById('cfg_e5').value = CFG.basePct['Euro 5'];
        document.getElementById('cfg_e4').value = CFG.basePct['Euro 4'];
        document.getElementById('cfg_floor').value = CFG.co2Floor;
        document.getElementById('cfg_rate').value  = CFG.co2Rate;
        document.getElementById('cfg_mhev').value  = CFG.hybrid.mhev;
        document.getElementById('cfg_phev').value  = CFG.hybrid.phev;
        document.getElementById('cfg_petrol').value= CFG.fuel.petrol;
        document.getElementById('cfg_diesel').value= CFG.fuel.diesel;
        document.getElementById('cfg_m1').value    = CFG.category.M1;
        document.getElementById('cfg_n1').value    = CFG.category.N1;
        document.getElementById('cfg_age').value   = CFG.agePerYear;
        document.getElementById('cfg_uplift').value= CFG.uplift;
        document.getElementById('cfg_env5').value  = CFG.envFeeEuro5;

        document.getElementById('cfgSave').onclick = ()=>{
          CFG = {
            basePct:{
              'Euro 6': +document.getElementById('cfg_e6').value || 0,
              'Euro 5': +document.getElementById('cfg_e5').value || 0,
              'Euro 4': +document.getElementById('cfg_e4').value || 0,
            },
            co2Floor:+document.getElementById('cfg_floor').value || 0,
            co2Rate:+document.getElementById('cfg_rate').value || 0,
            hybrid:{ none:1.00, mhev:+document.getElementById('cfg_mhev').value || 1, phev:+document.getElementById('cfg_phev').value || 1 },
            fuel:{ petrol:+document.getElementById('cfg_petrol').value || 1, diesel:+document.getElementById('cfg_diesel').value || 1 },
            category:{ M1:+document.getElementById('cfg_m1').value || 1, N1:+document.getElementById('cfg_n1').value || 1 },
            agePerYear:+document.getElementById('cfg_age').value || 0,
            uplift:+document.getElementById('cfg_uplift').value || 1,
            envFeeEuro5:+document.getElementById('cfg_env5').value || 0
          };
          saveCFG(CFG);
          alert('Αποθηκεύτηκε το CFG.');
        };
        document.getElementById('cfgReset').onclick = ()=>{
          CFG = JSON.parse(JSON.stringify(CFG_DEFAULT));
          saveCFG(CFG);
          alert('Έγινε επαναφορά.'); location.reload();
        };
        // Export
        document.getElementById('cfgExport').onclick = ()=>{
          const blob = new Blob([JSON.stringify(CFG,null,2)],{type:'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href=url; a.download='cfg.json';
          document.body.appendChild(a); a.click(); document.body.removeChild(a);
          URL.revokeObjectURL(url);
        };
        // Import
        document.getElementById('cfgImportBtn').onclick = ()=> document.getElementById('cfgImport').click();
        document.getElementById('cfgImport').addEventListener('change',()=>{
          const f = document.getElementById('cfgImport').files?.[0];
          if(!f){ alert('Δεν διάλεξες αρχείο.'); return; }
          const r = new FileReader();
          r.onload = e=>{
            try{
              const data = JSON.parse(e.target.result);
              saveCFG(data); alert('Το CFG έγινε εισαγωγή.'); location.reload();
            }catch{ alert('Λάθος αρχείο CFG'); }
          };
          r.readAsText(f);
        });
      }else{
        document.getElementById('cfgPanel').classList.remove('show');
        document.getElementById('cfgBtn').textContent = 'CFG';
      }
    }
    showCfgIfNeeded();

    // ===== Seed 2 demo rows (αν άδειο – μπορείς να τα σβήσεις)
    if(loadPerm().length===0){
      savePerm([
        {id:1, makeModel:'BMW M440d xDrive Coupé', euro:'Euro 6', co2:139, cc:2993, km:70000, fuel:'diesel', hybrid:'mhev', category:'M1', vin:'WBA1TEST123456789', purchase:49990, pretax:0, para:'yes', prodDate:'2021-05-01', estCustoms:8500, lockedCustoms:null, gear:'auto', extras:['navi','rims','park','cam']},
        {id:2, makeModel:'Peugeot 3008 1.5 BlueHDi', euro:'Euro 6', co2:130, cc:1499, km:67000, fuel:'diesel', hybrid:'none', category:'M1', vin:'VF3TEST9876543210', purchase:13000, pretax:0, para:'no', prodDate:'2020-01-20', estCustoms:4200, lockedCustoms:4500, gear:'manual', extras:['navi']}
      ]);
    }
    render();
  </script>
</body>
</html>
