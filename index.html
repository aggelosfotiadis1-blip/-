<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Center Car — Εκτελωνισμοί (Demo)</title>
  <style>
    :root{
      --bg:#f7f7fb;--card:#fff;--text:#1b1b1f;--muted:#666;--accent:#0d6efd;
      --danger:#dc3545;--ok:#198754;--border:#e6e6ee
    }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);
      font:16px -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
    header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);
      padding:12px 16px;z-index:10}
    h1{margin:0;font-size:20px}
    main{padding:16px;max-width:860px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1 1 200px}
    label{display:block;font-size:13px;margin:8px 0 6px;color:var(--muted)}
    input,select,button,textarea{
      width:100%;border:1px solid var(--border);border-radius:10px;padding:10px 12px;
      background:#fff;font-size:16px
    }
    input[type="number"]{appearance:textfield}
    .chip-group{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);padding:8px 12px;border-radius:999px;cursor:pointer;background:#fff}
    .chip.active{border-color:var(--accent);color:var(--accent);font-weight:600}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{background:#eee;border:1px solid var(--border);border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn.ghost{background:#fff}
    .btn.danger{background:var(--danger);border-color:var(--danger);color:#fff}
    .list{display:flex;flex-direction:column;gap:12px;margin-top:16px}
    .badge{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:3px 8px;font-size:12px;margin-right:6px}
    .muted{color:var(--muted);font-size:12px}
    .row-top{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .title{font-weight:700;font-size:18px}
    .right-actions{display:flex;gap:8px}
    .note{margin-top:8px;color:var(--muted);font-size:12px}
    .sep{height:1px;background:var(--border);margin:12px 0}
    .hint{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Center Car — Εκτελωνισμοί <span class="muted">(Demo)</span></h1>
  </header>

  <main>
    <!-- ΦΟΡΜΑ -->
    <div class="card" id="formCard">
      <div class="row">
        <div class="col">
          <label for="makeModel">Μάρκα / Μοντέλο</label>
          <input id="makeModel" placeholder="π.χ. BMW M440d xDrive" />
        </div>
        <div class="col">
          <label for="vin">VIN</label>
          <input id="vin" placeholder="π.χ. WBA..." />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="euro">Euro</label>
          <select id="euro">
            <option value="6" selected>Euro 6</option>
            <option value="5">Euro 5</option>
            <option value="4">Euro 4</option>
          </select>
        </div>
        <div class="col">
          <label for="co2">CO₂ (V7)</label>
          <input id="co2" type="number" inputmode="numeric" placeholder="π.χ. 129" />
        </div>
        <div class="col">
          <label for="kms">Χιλιόμετρα</label>
          <input id="kms" type="number" inputmode="numeric" placeholder="π.χ. 70000" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="price">Τιμή Αγοράς (€)</label>
          <input id="price" type="number" inputmode="decimal" placeholder="π.χ. 49990" />
        </div>
        <div class="col">
          <label for="locked">Κλειδωμένο Τελωνείο (τελικό)</label>
          <input id="locked" type="number" inputmode="decimal" placeholder="π.χ. 8500" />
          <div class="hint">Το “Κλειδωμένο” είναι καθαρά χειροκίνητο πεδίο για όταν κλείνεις τιμή.</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Παράγραφος 25a</label>
          <select id="para">
            <option value="yes" selected>Ναι (χωρίς ΦΠΑ)</option>
            <option value="no">Όχι</option>
          </select>
        </div>
        <div class="col">
          <label>Κιβώτιο</label>
          <select id="gearbox">
            <option value="auto" selected>Αυτόματο</option>
            <option value="manual">Χειροκίνητο</option>
          </select>
        </div>
      </div>

      <label>Υβριδισμός</label>
      <div class="chip-group" id="hybridGroup">
        <div class="chip active" data-v="none">Μη υβριδικό</div>
        <div class="chip" data-v="mhev">Mild Hybrid</div>
        <div class="chip" data-v="phev">Plug-in Hybrid</div>
      </div>

      <label style="margin-top:10px">Εξοπλισμός (προαιρετικό)</label>
      <div class="chip-group" id="equipGroup">
        <div class="chip" data-v="auto">Αυτόματο</div>
        <div class="chip" data-v="heat">Θερμαινόμενα</div>
        <div class="chip" data-v="led">Προβολάκια</div>
        <div class="chip" data-v="navi">Navi</div>
        <div class="chip" data-v="park">Parktronic</div>
        <div class="chip" data-v="leather">Δερμάτινα</div>
        <div class="chip" data-v="roof">Οροφή</div>
        <div class="chip" data-v="wheels">Ζάντες</div>
        <div class="chip" data-v="metal">Μεταλλικό</div>
        <div class="chip" data-v="rain">Αισθητήρες Βροχής</div>
        <div class="chip" data-v="cc">Cruise Control</div>
        <div class="chip" data-v="hud">Head-Up Display</div>
        <div class="chip" data-v="cam">Κάμερα Οπισθοπορείας</div>
      </div>

      <div class="sep"></div>

      <div class="actions">
        <button class="btn primary" id="saveBtn">Αποθήκευση</button>
        <button class="btn ghost" id="newBtn">Νέο/Καθαρισμός</button>
      </div>
      <div class="note">Η εκτίμηση τελωνείου στο demo είναι χειροκίνητη/ενδεικτική. Η τελική λογική θα συνδεθεί στο production.</div>
    </div>

    <!-- ΛΙΣΤΑ -->
    <div class="list" id="list"></div>
  </main>

  <script>
    // ---------- Μικρά helpers ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];
    const fmt = n => (n===undefined || n===null || n==="" ? "—" : Number(n).toLocaleString("el-GR"));

    // ---------- “Κατάσταση” φόρμας ----------
    let editingId = null; // αν είναι set => κάνουμε επεξεργασία

    // ---------- LocalStorage ----------
    const KEY = "centercar_cars_v2";
    const load = () => {
      try{ return JSON.parse(localStorage.getItem(KEY)) || []; }catch{ return []; }
    };
    const save = arr => localStorage.setItem(KEY, JSON.stringify(arr));
    const upsert = (obj) => {
      const arr = load();
      if (obj.id == null) { // νέο
        obj.id = Date.now();
        arr.unshift(obj);
      } else {
        const i = arr.findIndex(x=>x.id===obj.id);
        if (i>-1) arr[i]=obj;
      }
      save(arr);
      render();
    };
    const remove = (id) => { save(load().filter(x=>x.id!==id)); render(); };

    // ---------- Chips ----------
    function wireChips(group, single=true){
      group.addEventListener('click', (e)=>{
        const c = e.target.closest('.chip'); if(!c) return;
        if (single){
          group.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
          c.classList.add('active');
        } else {
          c.classList.toggle('active');
        }
      });
    }
    wireChips($('#hybridGroup'), true);
    wireChips($('#equipGroup'), false);

    // ---------- Συλλογή πεδίων φόρμας ----------
    function readForm(){
      const hybrid = $('#hybridGroup .chip.active')?.dataset.v || 'none';
      const extras = $$('#equipGroup .chip.active').map(x=>x.dataset.v);
      return {
        id: editingId,
        makeModel: $('#makeModel').value.trim(),
        vin: $('#vin').value.trim(),
        euro: $('#euro').value,
        co2: +$('#co2').value || 0,
        kms: +$('#kms').value || 0,
        price: +$('#price').value || 0,
        para: $('#para').value,         // yes/no
        gearbox: $('#gearbox').value,   // auto/manual
        hybrid,                         // none/mhev/phev
        extras,                         // array
        locked: $('#locked').value ? +$('#locked').value : null
      };
    }

    function fillForm(x){
      editingId = x?.id ?? null;
      $('#makeModel').value = x?.makeModel || '';
      $('#vin').value = x?.vin || '';
      $('#euro').value = x?.euro ?? '6';
      $('#co2').value = x?.co2 ?? '';
      $('#kms').value = x?.kms ?? '';
      $('#price').value = x?.price ?? '';
      $('#para').value = x?.para ?? 'yes';
      $('#gearbox').value = x?.gearbox ?? 'auto';
      $('#locked').value = (x?.locked ?? '') === null ? '' : (x?.locked ?? '');

      // hybrid chips
      $('#hybridGroup .chip.active')?.classList.remove('active');
      const hSel = x?.hybrid || 'none';
      $('#hybridGroup .chip[data-v="'+hSel+'"]').classList.add('active');

      // extras chips
      $$('#equipGroup .chip').forEach(c=>c.classList.remove('active'));
      (x?.extras || []).forEach(v=>{
        const el = $('#equipGroup .chip[data-v="'+v+'"]'); if(el) el.classList.add('active');
      });

      $('#saveBtn').textContent = editingId ? 'Ενημέρωση' : 'Αποθήκευση';
    }

    function clearForm(){
      fillForm(null);
      $('#makeModel').focus();
    }

    // ---------- Απόδοση λίστας ----------
    function render(){
      const arr = load();
      const el = $('#list');
      el.innerHTML = '';
      if(!arr.length){
        const empty = document.createElement('div');
        empty.className = 'card';
        empty.innerHTML = '<div class="muted">Δεν υπάρχουν οχήματα. Συμπλήρωσε τη φόρμα παραπάνω και πάτησε «Αποθήκευση».</div>';
        el.appendChild(empty);
        return;
      }
      arr.forEach(x=>{
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `
          <div class="row-top">
            <div class="title">${x.makeModel || '—'}</div>
            <div class="right-actions">
              <button class="btn" data-edit="${x.id}">Επεξεργασία</button>
              <button class="btn danger" data-del="${x.id}">Διαγραφή</button>
            </div>
          </div>
          <div style="margin-top:6px">
            <span class="badge">Euro ${x.euro || '—'}</span>
            <span class="badge">${x.co2 || '—'} g/km</span>
            <span class="badge">${x.para==='yes' ? '25a' : 'με ΦΠΑ'}</span>
            ${x.hybrid!=='none' ? `<span class="badge">${x.hybrid==='mhev'?'MHEV':'PHEV'}</span>` : ''}
          </div>
          <div class="muted" style="margin-top:6px">VIN: ${x.vin || '—'}</div>
          <div class="row" style="margin-top:6px">
            <div class="col"><strong>Χιλιόμετρα:</strong> ${fmt(x.kms)}</div>
            <div class="col"><strong>Αγορά:</strong> ${fmt(x.price)} €</div>
            <div class="col"><strong>Κλειδωμένο:</strong> ${x.locked==null ? '—' : fmt(x.locked)+' €'}</div>
          </div>
        `;
        // actions
        item.querySelector('[data-edit]').addEventListener('click',()=> fillForm(x));
        item.querySelector('[data-del]').addEventListener('click',()=>{
          if(confirm('Σίγουρα διαγραφή;')) remove(x.id);
        });
        el.appendChild(item);
      });
    }

    // ---------- Events ----------
    $('#saveBtn').addEventListener('click', ()=>{
      const data = readForm();

      // Μικρός έλεγχος: απαιτητικά πεδία
      if(!data.makeModel){ alert('Γράψε Μάρκα/Μοντέλο'); return; }
      if(!data.price){ alert('Βάλε Τιμή Αγοράς'); return; }

      upsert(data);
      clearForm();
      window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
    });

    $('#newBtn').addEventListener('click', clearForm);

    // ---------- Init ----------
    fillForm(null);   // ανοίγει καθαρή φόρμα
    render();         // φορτώνει ό,τι υπάρχει στο localStorage
  </script>
</body>
</html>
